{% load static %}


<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link type="text/css" href="{% static 'send/css/styles.css' %}" rel="stylesheet" />
  </head>
  <body>
    <div class="container-fluid general-container ">
        <div class="row zz">
          <section class="header">
            <div class="col text-center fs-bold  header-text">
              Сервис Email рассылок
            </div>
          </section>
        </div>
    </div>

    <div class="container-fluid">
      <div class="row justify-content-center">

          <div class="col-7  text-center mt-4 content-text">
            Удобное решение для отправки HTML рассылок с использованием переменных в макете и отслеживания открытий писем.
          </div>
      </div>
      <div class="row mt-4 justify-content-center">
          <div class="col-2">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCampaignModal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
                     <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"/>
                    </svg> Создать рассылку
                </button>
          </div>

      </div>
    </div>

    <div class="container">
        <section class="advantages">
            <div class="row mt-4">
                <div class="col-md-6 ">
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-code"></i>
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-filetype-html" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5Zm-9.736 7.35v3.999h-.791v-1.714H1.79v1.714H1V11.85h.791v1.626h1.682V11.85h.79Zm2.251.662v3.337h-.794v-3.337H4.588v-.662h3.064v.662H6.515Zm2.176 3.337v-2.66h.038l.952 2.159h.516l.946-2.16h.038v2.661h.715V11.85h-.8l-1.14 2.596H9.93L8.79 11.85h-.805v3.999h.706Zm4.71-.674h1.696v.674H12.61V11.85h.79v3.325Z"/>
                                </svg>
                                HTML макет рассылки</h5>
                            <p class="card-text">Используйте готовые HTML шаблоны с возможностью динамической подстановки переменных: <code>{firstName}</code>, <code>{lastName}</code>, <code>{birthday}</code>.</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 ">
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-clock"></i>
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-alarm" viewBox="0 0 16 16">
                            <path d="M8.5 5.5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9V5.5z"/>
                            <path d="M6.5 0a.5.5 0 0 0 0 1H7v1.07a7.001 7.001 0 0 0-3.273 12.474l-.602.602a.5.5 0 0 0 .707.708l.746-.746A6.97 6.97 0 0 0 8 16a6.97 6.97 0 0 0 3.422-.892l.746.746a.5.5 0 0 0 .707-.708l-.601-.602A7.001 7.001 0 0 0 9 2.07V1h.5a.5.5 0 0 0 0-1h-3zm1.038 3.018a6.093 6.093 0 0 1 .924 0 6 6 0 1 1-.924 0zM0 3.5c0 .753.333 1.429.86 1.887A8.035 8.035 0 0 1 4.387 1.86 2.5 2.5 0 0 0 0 3.5zM13.5 1c-.753 0-1.429.333-1.887.86a8.035 8.035 0 0 1 3.527 3.527A2.5 2.5 0 0 0 13.5 1z"/>
                            </svg>
                            Отложенные рассылки</h5>
                            <p class="card-text">Планируйте рассылки на нужное время с помощью отложенной отправки.</p>
                         </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-paper-plane"></i>
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-send-check-fill" viewBox="0 0 16 16">
                            <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 1.59 2.498C8 14 8 13 8 12.5a4.5 4.5 0 0 1 5.026-4.47L15.964.686Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
                            <path d="M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Zm-1.993-1.679a.5.5 0 0 0-.686.172l-1.17 1.95-.547-.547a.5.5 0 0 0-.708.708l.774.773a.75.75 0 0 0 1.174-.144l1.335-2.226a.5.5 0 0 0-.172-.686Z"/>
                            </svg>
                            AJAX отправка</h5>
                            <p class="card-text">Создавайте и отправляйте рассылки, используя AJAX запросы для мгновенной обработки.</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-eye"></i>
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                            <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                            <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                            </svg>
                            Отслеживание открытий</h5>
                            <p class="card-text">Получайте статистику по открытию писем с помощью встроенного трекинга на основе скрытого пикселя.</p>
                        </div>
                     </div>
                </div>

            </div>
        </section>
    </div>

    <footer>
        <div class="container">
            <div class="row mt-5 mb-3">
                <div class="col text-center">
                   <p class="mb-0">© 2025 Email Рассылка Сервис. Все права защищены.</p>
                </div>
            </div>
        </div>
   </footer>

<!--modal window-->
    <div class="modal fade" id="createCampaignModal" tabindex="-1" aria-labelledby="createCampaignModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="campaignForm">
          <div class="modal-header">
            <h5 class="modal-title" id="createCampaignModalLabel">Создать новую рассылку</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
          </div>
          <div class="modal-body">
            <!-- Тема письма -->
            <div class="mb-3">
              <label for="subject" class="form-label">Тема письма</label>
              <input type="text" class="form-control" id="subject" name="subject" placeholder="Введите тему рассылки" required="">
            </div>
            <!-- HTML макет письма с кнопкой предпросмотра -->
            <div class="mb-3">
              <label for="htmlTemplate" class="form-label">HTML макет письма</label>
              <textarea class="form-control" id="htmlTemplate" name="htmlTemplate" rows="6" placeholder="Введите HTML код письма. Используйте переменные: {firstName}, {lastName}, {birthday}" required=""></textarea>
              <button class="btn btn-outline-info mt-2" type="button" id="previewTemplateButton">
                 Предварительный просмотр шаблона
              </button>
            </div>
            <!-- Список подписчиков -->
            <div class="mb-3">
              <label for="subscribers" class="form-label">Список подписчиков</label>
              <textarea class="form-control" id="subscribers" name="subscribers" rows="4" placeholder="Введите адреса электронных почт, разделённые запятой" required=""></textarea>
            </div>
            <!-- Отложенная отправка -->
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" value="" id="delayedSend">
              <label class="form-check-label" for="delayedSend">
                Запланировать отправку на определённое время
              </label>
            </div>
            <!-- Поле выбора даты и времени отправки, отображается при выборе отложенной отправки -->
            <div class="mb-3 d-none" id="scheduleTimeGroup">
              <label for="scheduleTime" class="form-label">Дата и время отправки</label>
              <input type="datetime-local" class="form-control" id="scheduleTime" name="scheduleTime">
            </div>
            <!-- Информация по отслеживанию открытий -->
            <div class="mb-3">
              <small class="text-muted">В макет письма автоматически будет добавлен невидимый пиксель для отслеживания открытий.</small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
            <button type="submit" class="btn btn-success">
              <i class="fas fa-paper-plane"></i> Отправить рассылку
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
<!--    the end modal window-->
<!--    view-->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="previewModalLabel">Предварительный просмотр HTML шаблона</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
        </div>
        <div class="modal-body">
          <iframe id="htmlPreviewFrame" style="width:100%; height:500px; border: none;"></iframe>
        </div>
      </div>
    </div>
  </div>
<!--    endview-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  </body>
</html>


<script>

    // Установка динамического фонового изображения для hero секции через Unsplash API
    fetch("https://api.unsplash.com/search/photos?query=office,technology&client_id=JHtE8oFrTbp4eEZabR_itpVTxMw1432yX0v38OtD08U")
      .then(response => response.json())
      .then(data => {
        if (data.results.length > 0) {
          document.querySelector(".hero").style.backgroundImage = `url(${data.results[0].urls.regular})`;
        }
      })
      .catch(error => console.error("Ошибка загрузки фонового изображения:", error));

    // Переключение поля для планирования отправки
    $("#delayedSend").on("change", function() {
      if ($(this).is(":checked")) {
        $("#scheduleTimeGroup").removeClass("d-none");
        $("#scheduleTime").prop("required", true);
      } else {
        $("#scheduleTimeGroup").addClass("d-none");
        $("#scheduleTime").prop("required", false);
      }
    });

    // Обработка формы создания рассылки через AJAX
    $("#campaignForm").on("submit", function(e) {
      e.preventDefault();

      // Собираем данные формы
      const formData = {
        subject: $("#subject").val(),
        htmlTemplate: $("#htmlTemplate").val(),
        subscribers: $("#subscribers").val().split(",").map(email => email.trim()).filter(email => email !== ""),
        scheduleTime: $("#delayedSend").is(":checked") ? $("#scheduleTime").val() : null
      };

      // Дополнение макета письма пикселем для отслеживания открытий
      // Здесь добавим img тег с tracking URL, который будет вставлен в конец HTML
      const trackingPixel = '<img src="https://your-tracking-domain.com/track?campaign_id=XYZ" alt="" style="display:none;width:1px;height:1px;">';
      formData.htmlTemplate += trackingPixel;

      // Имитация AJAX запроса (здесь можно использовать реальный endpoint)
      $.ajax({
        url: "https://jsonplaceholder.typicode.com/posts",
        method: "POST",
        data: JSON.stringify(formData),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        beforeSend: function() {
          // Блокируем кнопку, можно добавить спиннер
          $("#campaignForm button[type='submit']").prop("disabled", true);
        },
        success: function(response) {
          // Вывод сообщения об успешной отправке рассылки
          alert("Рассылка успешно создана и отправлена!");
          // Сброс формы
          $("#campaignForm")[0].reset();
          $("#scheduleTimeGroup").addClass("d-none");
          // Закрыть модальное окно
          $("#createCampaignModal").modal("hide");
        },
        error: function(error) {
          alert("Ошибка при отправке рассылки. Попробуйте еще раз.");
          console.error("Ошибка AJAX:", error);
        },
        complete: function() {
          $("#campaignForm button[type='submit']").prop("disabled", false);
        }
      });
    });

    // Обработка показа предварительного просмотра HTML шаблона
    $("#previewTemplateButton").on("click", function() {
      // Получаем введённый HTML шаблон
      const template = $("#htmlTemplate").val();
      // Записываем его в iframe для предварительного просмотра
      const previewFrame = document.getElementById("htmlPreviewFrame");
      const previewDocument = previewFrame.contentDocument || previewFrame.contentWindow.document;
      previewDocument.open();
      previewDocument.write(template);
      previewDocument.close();
      // Открываем модальное окно с предпросмотром
      $("#previewModal").modal("show");
    });

</script>